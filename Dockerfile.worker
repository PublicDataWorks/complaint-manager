ARG INSTANCE_VERSION=latest

FROM noipm/instance-files:$INSTANCE_VERSION AS instance
FROM noipm/docker-node-ubuntu:2.0.1

RUN apt-get update
RUN apt-get install bash

WORKDIR /app
COPY package.json yarn.lock /app/
RUN yarn install --pure-lockfile

COPY --from=instance /instance-files /app/src/instance-files
COPY . /app/

RUN yarn build

EXPOSE 5000

CMD ["yarn", "start:worker"]